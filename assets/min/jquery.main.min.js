function Setup_Grid(){grid.width=grid.column*config.block,grid.height=grid.row*config.block,grid.element.width(grid.column*config.block).height(grid.row*config.block);var i;for(i=1;i<=grid.column;i++){grid.structure[i]=new Array;var j;for(j=1;j<=grid.row;j++)grid.structure[i][j]={occupied:!1}}}function Action_ArrangeGrid(column_this,row_this){var left=(column_this-1)*config.block;grid.element.css({left:"-"+left+"px"});var top=(row_this-1)*config.block;grid.element.css({top:"-"+top+"px"})}function Setup_Elements(){$(".element").each(function(){var element={};element.element=$(this),element.column=Number(element.element.attr("column")),element.row=Number(element.element.attr("row")),element.occupied=element.element.attr("occupied"),element.width=Number(element.element.attr("width")),element.height=Number(element.element.attr("height")),"false"!=element.occupied&&(grid.structure[element.column][element.row].occupied=!0),element.element.css({top:(element.row-1)*config.block+"px",left:(element.column-1)*config.block+"px"});var width_element=config.block*element.width;if(""!=element.element.attr("width")&&(element.element.css("width",width_element+"px"),"false"!=element.occupied)){var i;for(i=1;i<=element.width-1;i++)grid.structure[element.column+i][element.row].occupied=!0}var height_element=config.block*element.height;if(""!=element.element.attr("height")&&(element.element.css("height",height_element+"px"),"false"!=element.occupied)){var i;for(i=1;i<=element.height-1;i++)grid.structure[element.column][element.row+i].occupied=!0}if(""!=element.element.attr("height")&&""!=element.element.attr("width")){var i;for(i=1;i<=Number(element.element.attr("height"))-1;i++){var j;for(j=1;j<=Number(element.element.attr("width"))-1;j++)grid.structure[element.column+j][element.row+i].occupied=!0}}})}function Load_Character(who,element){config.placement=0;var door={};door.element=element,door.column=Number($(door.element).attr("column")),door.row=Number($(door.element).attr("row")),Action_ArrangeCharacter(who,door.column,door.row,1)}function Action_ArrangeCharacter(who,column_this,row_this,position){var element={};element.element=who,element.column=column_this,element.row=row_this,Action_OccupiedCheck(element.column,element.row,"simple")&&Action_OccupiedCheck(element.column,element.row,"exists")?Action_OccupiedCheck(element.column,element.row,"occupied")?Action_PlaceCharacter(element.element,element.column,element.row):Action_ArrangeCharacterChecking(element.element,element.column,element.row,position):Action_ArrangeCharacterChecking(element.element,element.column,element.row,position)}function Action_ArrangeCharacterChecking(who,column_this,row_this,position){var element={};element.element=who,element.column=column_this,element.row=row_this;var next,turn,polarity;1==position?(next=2,turn="row",polarity="+",config.placement++):2==position?(next=3,turn="column",polarity="-"):3==position?(next=4,turn="row",polarity="-",config.placement++):4==position&&(next=1,turn="column",polarity="+");for(var i=1;i<=config.placement;i++)if("+"==polarity?element[turn]++:"-"==polarity&&element[turn]--,Action_OccupiedCheck(element.column,element.row,"simple")&&Action_OccupiedCheck(element.column,element.row,"exists")){if(Action_OccupiedCheck(element.column,element.row,"occupied")){Action_PlaceCharacter(element.element,element.column,element.row);break}if(i==config.placement){Action_ArrangeCharacter(element.element,element.column,element.row,next);break}}else if(i==config.placement){Action_ArrangeCharacter(element.element,element.column,element.row,next);break}}function Action_PlaceCharacter(who,column_this,row_this){var element={};element.element=who,element.column=column_this,element.row=row_this,Action_ArrangeGrid(element.column,element.row),Action_PlaceAllCharacters(element.element,element.column,element.row)}function Action_PlaceAllCharacters(who,column_this,row_this){var element={};element.element=who,element.column=column_this,element.row=row_this,grid.structure[element.column][element.row].occupied=!0,grid.element.append('<div id="'+element.element+'" class="character position-1-2" column="'+element.column+'" row="'+element.row+'" style="left:'+(element.column-1)*config.block+"px;top:"+(element.row-1)*config.block+'px;"></div>')}function Action_KeyPressed(e){39==e.keyCode?Action_CharacterMovement(me.who,"right","+",3):40==e.keyCode?Action_CharacterMovement(me.who,"down","+",1):37==e.keyCode?Action_CharacterMovement(me.who,"left","-",2):38==e.keyCode?Action_CharacterMovement(me.who,"up","-",4):83==e.keyCode&&Action_Sit(me.who)}function Action_CharacterMovement(who,position,polarity,direction){Action_AnimateCharacterMovement(who,position,direction);var element={};element.element=$(who),element.column=element.element.attr("column"),element.row=element.element.attr("row");var column_next,row_next;"right"==position?(column_next=Number(element.column)+1,row_next=element.row):"left"==position?(column_next=Number(element.column)-1,row_next=element.row):"up"==position?(column_next=element.column,row_next=Number(element.row)-1):"down"==position&&(column_next=element.column,row_next=Number(element.row)+1),Action_OccupiedCheck(column_next,row_next,"simple")&&Action_OccupiedCheck(column_next,row_next,"exists")&&Action_OccupiedCheck(column_next,row_next,"occupied")&&0==Character_MovementLock&&("+"==polarity?polarity_grid="-":"-"==polarity&&(polarity_grid="+"),grid.structure[element.column][element.row].occupied=!1,grid.structure[column_next][row_next].occupied=!0,Character_MovementLock=!0,"right"==position||"left"==position?(element.element.animate({left:polarity+"="+config.block},3*config.timing,function(){Character_MovementLock=!1}),grid.element.animate({left:polarity_grid+"="+config.block},3*config.timing,function(){}),"right"==position?element.element.attr("column",Number(element.column)+1):"left"==position&&element.element.attr("column",Number(element.column)-1)):("up"==position||"down"==position)&&(element.element.animate({top:polarity+"="+config.block},3*config.timing,function(){Character_MovementLock=!1}),grid.element.animate({top:polarity_grid+"="+config.block},3*config.timing,function(){}),"up"==position?element.element.attr("row",Number(element.row)-1):"down"==position&&element.element.attr("row",Number(element.row)+1)))}function Action_OccupiedCheck(column_this,row_this,type){var value;return value="simple"==type?0!=row_this&&0!=column_this&&row_this<=grid.row&&column_this<=grid.column:"exists"==type?null!=grid.structure[column_this]&&null!=grid.structure[column_this][row_this]:"occupied"==type?0==grid.structure[column_this][row_this].occupied:0==grid.structure[column_this][row_this].occupied&&0!=row_this&&0!=column_this&&row_this<=grid.row&&column_this<=grid.column}function Action_AnimateCharacterMovement(who,position,direction){0==Character_AnimateMovementLock&&(Character_AnimateMovementLock=!0,Action_ClearPosition(who),$(who).removeClass("sit").addClass("position-"+direction+"-1"),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-"+direction+"-2"),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-"+direction+"-3"),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-"+direction+"-2"),Character_AnimateMovementLock=!1},config.timing)},config.timing)},config.timing))}function Action_ClearPosition(who){var classList=$(who).attr("class").split(/\s+/);$.each(classList,function(index,classItem){classItem.includes("position")&&$(who).removeClass(classItem)})}function Action_Sit(who){(0==Character_AnimateMovementLock||0==Character_MovementLock)&&($(who).hasClass("sit")?$(who).removeClass("sit"):$(who).addClass("sit"))}var config={};config.block=84,config.timing=100;var grid={};grid.who="#grid",grid.element=$(grid.who),grid.structure=new Array,grid.column=Number(grid.element.attr("column")),grid.row=Number(grid.element.attr("row"));var me={};me.name="odd_gus",me.who="#"+me.name,Setup_Grid(),Setup_Elements(),Load_Character(me.name,"#initial"),config.placement,window.onkeydown=Action_KeyPressed;var Character_MovementLock=!1,Character_AnimateMovementLock=!1;