function Setup_Grid(){grid.width=column*block,grid.height=row*block,grid.element.width(column*block).height(row*block);var i;for(i=1;column>=i;i++){grid.structure[i]=new Array;var j;for(j=1;row>=j;j++)grid.structure[i][j]={occupied:!1}}}function Action_ArrangeGrid(column_this,row_this){var left=(column_this-1)*block;grid.element.css({left:"-"+left+"px"});var top=(row_this-1)*block;grid.element.css({top:"-"+top+"px"})}function Setup_Elements(){var element=$(".element");element.each(function(){var column_element=Number($(this).attr("column")),row_element=Number($(this).attr("row"));"false"!=$(this).attr("occupied")&&(grid.structure[column_element][row_element].occupied=!0),$(this).css({top:(row_element-1)*block+"px",left:(column_element-1)*block+"px"});var width_element=block*Number($(this).attr("width"));if(""!=$(this).attr("width")&&($(this).css("width",width_element+"px"),"false"!=$(this).attr("occupied"))){var i;for(i=1;i<=Number($(this).attr("width"))-1;i++)grid.structure[column_element+i][row_element].occupied=!0}var height_element=block*Number($(this).attr("height"));if(""!=$(this).attr("height")&&($(this).css("height",height_element+"px"),"false"!=$(this).attr("occupied"))){var i;for(i=1;i<=Number($(this).attr("height"))-1;i++)grid.structure[column_element][row_element+i].occupied=!0}if(""!=$(this).attr("height")&&""!=$(this).attr("width")){var i;for(i=1;i<=Number($(this).attr("height"))-1;i++){var j;for(j=1;j<=Number($(this).attr("width"))-1;j++)grid.structure[column_element+j][row_element+i].occupied=!0}}})}function Load_Character(door){var column_door=Number($(door).attr("column")),row_door=Number($(door).attr("row"));placement=0,Action_ArrangeCharacter("me",column_door,row_door,1)}function Action_ArrangeCharacter(who,column_this,row_this,position){Action_OccupiedCheck(column_this,row_this,"simple")&&Action_OccupiedCheck(column_this,row_this,"exists")?Action_OccupiedCheck(column_this,row_this,"occupied")?Action_PlaceCharacter(who,column_this,row_this):Action_ArrangeCharacterChecking(who,column_this,row_this,position):Action_ArrangeCharacterChecking(who,column_this,row_this,position)}function Action_ArrangeCharacterChecking(who,column_this,row_this,position){if(1==position){placement++;for(var i=1;placement>=i;i++)if(row_this++,Action_OccupiedCheck(column_this,row_this,"simple")&&Action_OccupiedCheck(column_this,row_this,"exists")){if(Action_OccupiedCheck(column_this,row_this,"occupied")){Action_PlaceCharacter(who,column_this,row_this);break}if(i==placement){Action_ArrangeCharacter(who,column_this,row_this,2);break}}else if(i==placement){Action_ArrangeCharacter(who,column_this,row_this,2);break}}else if(2==position){for(var i=1;placement>=i;i++)if(column_this--,Action_OccupiedCheck(column_this,row_this,"simple")&&Action_OccupiedCheck(column_this,row_this,"exists")){if(Action_OccupiedCheck(column_this,row_this,"occupied")){Action_PlaceCharacter(who,column_this,row_this);break}if(i==placement){Action_ArrangeCharacter(who,column_this,row_this,3);break}}else if(i==placement){Action_ArrangeCharacter(who,column_this,row_this,3);break}}else if(3==position){placement++;for(var i=1;placement>=i;i++)if(row_this--,Action_OccupiedCheck(column_this,row_this,"simple")&&Action_OccupiedCheck(column_this,row_this,"exists")){if(Action_OccupiedCheck(column_this,row_this,"occupied")){Action_PlaceCharacter(who,column_this,row_this);break}if(i==placement){Action_ArrangeCharacter(who,column_this,row_this,4);break}}else if(i==placement){Action_ArrangeCharacter(who,column_this,row_this,4);break}}else if(4==position)for(var i=1;placement>=i;i++)if(column_this++,Action_OccupiedCheck(column_this,row_this,"simple")&&Action_OccupiedCheck(column_this,row_this,"exists")){if(Action_OccupiedCheck(column_this,row_this,"occupied")){Action_PlaceCharacter(who,column_this,row_this);break}if(i==placement){Action_ArrangeCharacter(who,column_this,row_this,1);break}}else if(i==placement){Action_ArrangeCharacter(who,column_this,row_this,1);break}}function Action_PlaceCharacter(who,column_this,row_this){Action_ArrangeGrid(column_this,row_this),Action_PlaceAllCharacters(who,column_this,row_this)}function Action_PlaceAllCharacters(who,column_this,row_this){grid.structure[column_this][row_this].occupied=!0,grid.element.append('<div id="'+who+'" class="character position-1-2" column="'+column_this+'" row="'+row_this+'" style="left:'+(column_this-1)*block+"px;top:"+(row_this-1)*block+'px;"></div>')}function Action_KeyPressed(e){39==e.keyCode?Action_CharacterMovement("#me","right","+",3):40==e.keyCode?Action_CharacterMovement("#me","down","+",1):37==e.keyCode?Action_CharacterMovement("#me","left","-",2):38==e.keyCode?Action_CharacterMovement("#me","up","-",4):83==e.keyCode&&Action_Sit("#me")}function Action_CharacterMovement(who,position,polarity,direction){Action_AnimateCharacterMovement(who,position,direction);var column_next,row_next,column_element=$(who).attr("column"),row_element=$(who).attr("row");"right"==position?(column_next=Number(column_element)+1,row_next=row_element):"left"==position?(column_next=Number(column_element)-1,row_next=row_element):"up"==position?(column_next=column_element,row_next=Number(row_element)-1):"down"==position&&(column_next=column_element,row_next=Number(row_element)+1),Action_OccupiedCheck(column_next,row_next,"complete")&&0==Character_MovementLock&&("+"==polarity?polarity_grid="-":"-"==polarity&&(polarity_grid="+"),grid.structure[column_element][row_element].occupied=!1,grid.structure[column_next][row_next].occupied=!0,Character_MovementLock=!0,"right"==position||"left"==position?($(who).animate({left:polarity+"="+block},3*timing,function(){Character_MovementLock=!1}),grid.element.animate({left:polarity_grid+"="+block},3*timing,function(){}),"right"==position?$(who).attr("column",Number(column_element)+1):"left"==position&&$(who).attr("column",Number(column_element)-1)):("up"==position||"down"==position)&&($(who).animate({top:polarity+"="+block},3*timing,function(){Character_MovementLock=!1}),grid.element.animate({top:polarity_grid+"="+block},3*timing,function(){}),"up"==position?$(who).attr("row",Number(row_element)-1):"down"==position&&$(who).attr("row",Number(row_element)+1)))}function Action_OccupiedCheck(column_this,row_this,type){var value;return value="simple"==type?0!=row_this&&0!=column_this&&row>=row_this&&column>=column_this:"exists"==type?null!=grid.structure[column_this]&&null!=grid.structure[column_this][row_this]:"occupied"==type?0==grid.structure[column_this][row_this].occupied:0==grid.structure[column_this][row_this].occupied&&0!=row_this&&0!=column_this&&row>=row_this&&column>=column_this}function Action_AnimateCharacterMovement(who,position,direction){0==Character_AnimateMovementLock&&(Character_AnimateMovementLock=!0,Action_ClearPosition(who),$(who).removeClass("sit").addClass("position-"+direction+"-1"),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-"+direction+"-2"),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-"+direction+"-3"),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-"+direction+"-2"),Character_AnimateMovementLock=!1},timing)},timing)},timing))}function Action_ClearPosition(who){var classList=$(who).attr("class").split(/\s+/);$.each(classList,function(index,classItem){classItem.includes("position")&&$(who).removeClass(classItem)})}function Action_Sit(who){(0==Character_AnimateMovementLock||0==Character_MovementLock)&&($(who).hasClass("sit")?$(who).removeClass("sit"):$(who).addClass("sit"))}var block=84,timing=100,grid={element:$("#grid"),structure:new Array},column=Number(grid.element.attr("column")),row=Number(grid.element.attr("row"));Setup_Grid(),Setup_Elements(),Load_Character("#initial","odd_gus");var placement;window.onkeydown=Action_KeyPressed;var Character_MovementLock=!1,Character_AnimateMovementLock=!1;