function Action_FadeOut(element){$(element).fadeOut()}function Action_FadeIn(element){$(element).fadeIn()}function Setup_Room(){config.app.append('\n			<form id="room-container">\n				<p>Escolha uma sala</p>\n				<input type="submit" class="room-unit" autocomplete="off" value="Charme" room="charm" />\n				<input type="submit" class="room-unit" autocomplete="off" value="Feitiço" room="spell" />\n				<input type="submit" class="room-unit" autocomplete="off" value="Azaração" room="jinx" />\n			</form>\n		'),$("form#room-container").submit(function(){return!1}),$(".room-unit").each(function(){$(this).click(function(){config.room=$(this).attr("room"),socket.emit("room",{room:config.room,map:config.map}),$("form#room-container").remove()})}),socket.on("room start",function(){Setup_Login()})}function Setup_Login(){config.app.append('\n			<form id="login">\n				<input type="text" id="email" autocomplete="off" placeholder="Email" />\n				<input type="password" id="password" autocomplete="off" placeholder="Senha" />\n				<button>Login</button>\n			</form>\n		'),$("form#login").submit(function(){var login={};return login.email=$("#email").val(),login.password=$("#password").val(),socket.emit("login",login),!1}),socket.on("start",function(data){me=data.user,character=data.character,Setup_Grid(config.map,config.door),config.started||(Setup_Socket(),Setup_Chat(),window.onkeydown=Action_KeyPressed,config.started=!0),$("#messages").empty()}),socket.on("failed login",function(data){$(".login-error").length?$(".login-error").empty().text(data):$("form#login").append('<p class="login-error">'+data+"</p>")})}function Setup_Socket(){var count_messages=0;socket.on("message",function(data){var count_local=count_messages;$("#messages").append($("<li>").text(data.user+": "+data.message)),$("#"+data.user+" .talk").length&&$("#"+data.user+" .talk").remove(),$("#"+data.user).append('<p class="talk talk-'+count_local+'">'+data.message+"</p>"),setTimeout(function(){$("#"+data.user+" .talk-"+count_local).remove(),count_messages++},15e3)}),socket.on("delete",function(user){grid.structure[character[user].column][character[user].row].occupied=!1,$("#"+user).remove(),delete character[user]}),socket.on("right",function(data){Action_CharacterMovement(character[data.user].who,"right","+",3)}),socket.on("down",function(data){Action_CharacterMovement(character[data.user].who,"down","+",1)}),socket.on("left",function(data){Action_CharacterMovement(character[data.user].who,"left","-",2)}),socket.on("up",function(data){Action_CharacterMovement(character[data.user].who,"up","-",4)}),socket.on("right movement",function(data){Action_AnimateCharacterMovement(character[data.user].who,"right",3)}),socket.on("down movement",function(data){Action_AnimateCharacterMovement(character[data.user].who,"down",1)}),socket.on("left movement",function(data){Action_AnimateCharacterMovement(character[data.user].who,"left",2)}),socket.on("up movement",function(data){Action_AnimateCharacterMovement(character[data.user].who,"up",4)}),socket.on("place",function(data){var who=data.user;character[data.user]=data.character,Action_PlaceAllCharacters(who,character[who].item,character[who].column,character[who].row,!0)}),socket.on("jump",function(data){var who=data.user;Action_Jump(character[who].who)}),socket.on("sit",function(data){var who=data.user;Action_Sit(character[who].who)})}function Setup_Chat(){$("body").append('\n			<div class="chat">\n				<ul id="messages"></ul>\n				<form action="">\n					<input id="message" autocomplete="off" />\n					<button>Enviar</button>\n				</form>\n			</div><!-- .chat -->\n		'),$(".chat form").submit(function(){var mensagem=$("#message").val();return socket.emit("message",mensagem),$("#message").val(""),!1})}function Setup_Grid(map,door){var url="map/"+map+".html";config.app.empty().load(url,function(){grid.who="#grid",grid.element=$(grid.who),grid.structure=new Array,grid.column=Number(grid.element.attr("column")),grid.row=Number(grid.element.attr("row")),grid.width=grid.column*config.block.size,grid.height=grid.row*config.block.size,grid.element.width(grid.column*config.block.size).height(grid.row*config.block.size);var i;for(i=1;i<=grid.column;i++){grid.structure[i]=new Array;var j;for(j=1;j<=grid.row;j++)grid.structure[i][j]={occupied:!1}}Setup_Elements(),Setup_Doors(),Setup_Users(),Load_Character(character[me].name,"#"+door)})}function Action_ArrangeGrid(column,row){var left=(column-1)*config.block.size;grid.element.css({left:"-"+left+"px"});var top=(row-1)*config.block.size;grid.element.css({top:"-"+top+"px"})}function Setup_Elements(){$(".element").each(function(){var column=Number($(this).attr("column")),row=Number($(this).attr("row")),occupied=$(this).attr("occupied"),width=Number($(this).attr("width")),height=Number($(this).attr("height")),zindex=Number($(this).css("z-index"));"false"!=occupied&&(grid.structure[column][row].occupied=!0),$(this).css({top:(row-1)*config.block.size+"px",left:(column-1)*config.block.size+"px","z-index":10*row+zindex});var width_element=config.block.size*width;if(""!=$(this).attr("width")&&($(this).css("width",width_element+"px"),"false"!=occupied)){var i;for(i=1;width-1>=i;i++)grid.structure[column+i][row].occupied=!0}var height_element=config.block.size*height;if(""!=$(this).attr("height")&&($(this).css("height",height_element+"px"),"false"!=occupied)){var i;for(i=1;height-1>=i;i++)grid.structure[column][row+i].occupied=!0}if(""!=$(this).attr("height")&&""!=$(this).attr("width")&&"false"!=occupied){var i;for(i=1;i<=Number($(this).attr("height"))-1;i++){var j;for(j=1;j<=Number($(this).attr("width"))-1;j++)grid.structure[column+j][row+i].occupied=!0}}})}function Setup_Users(){for(var user in character)if(user!=me){var who=user,item=character[who].item;if(""!=character[who].column&&""!=character[who].row){var column=character[who].column,row=character[who].row;Action_PlaceAllCharacters(who,item,column,row,!1)}}}function Action_UpdateUser(who,action){socket.emit("update user",{action:action,user:who,data:character[who]})}function Load_Character(who,element){config.placement=0;var door={};door.element=element,door.column=Number($(door.element).attr("column")),door.row=Number($(door.element).attr("row")),Action_ArrangeCharacter(who,door.column,door.row,1)}function Action_ArrangeCharacter(who,column,row,position){Action_OccupiedCheck(column,row,"simple")&&Action_OccupiedCheck(column,row,"exists")?Action_OccupiedCheck(column,row,"occupied")?Action_PlaceCharacter(who,column,row):Action_ArrangeCharacterChecking(who,column,row,position):Action_ArrangeCharacterChecking(who,column,row,position)}function Action_ArrangeCharacterChecking(who,column,row,position){var element={};element.column=column,element.row=row;var next,turn,polarity;1==position?(next=2,turn="row",polarity="+",config.placement++):2==position?(next=3,turn="column",polarity="-"):3==position?(next=4,turn="row",polarity="-",config.placement++):4==position&&(next=1,turn="column",polarity="+");for(var i=1;i<=config.placement;i++)if("+"==polarity?element[turn]++:"-"==polarity&&element[turn]--,Action_OccupiedCheck(element.column,element.row,"simple")&&Action_OccupiedCheck(element.column,element.row,"exists")){if(Action_OccupiedCheck(element.column,element.row,"occupied")){Action_PlaceCharacter(who,element.column,element.row);break}if(i==config.placement){Action_ArrangeCharacter(who,element.column,element.row,next);break}}else if(i==config.placement){Action_ArrangeCharacter(who,element.column,element.row,next);break}}function Action_PlaceCharacter(who,column,row){Action_ArrangeGrid(column,row),character[who].map=config.map,character[who].column=column,character[who].row=row,Action_UpdateUser(who,"place")}function Action_PlaceAllCharacters(who,item,column,row,apparate){grid.structure[column][row].occupied=!0,grid.element.append('<div id="'+who+'" class="character position-1-2" column="'+column+'" row="'+row+'" style="left:'+(column-1)*config.block.size+"px;top:"+(row-1)*config.block.size+"px;z-index:"+(10*row+2)+';"></div>'),Action_ClearPosition("#"+who),Action_GetItems("#"+who,item),apparate?Effect_Apparate("#"+who):$("#"+who).addClass("undefined"!=typeof character[who].position&&null!==character[who].position?character[who].position:"position-1-2"),character[who].sit&&$(character[who].who).addClass("sit")}function Action_GetItems(who,item){$.each(item,function(index,value){$(who).append('<div class="inner item '+index+" "+value+'"></div>')})}function Setup_Doors(){$(".door").each(function(){var column=Number($(this).attr("column")),row=Number($(this).attr("row")),width=Number($(this).attr("width")),height=Number($(this).attr("height"));$(this).css({top:(row-1)*config.block.size+"px",left:(column-1)*config.block.size+"px"});var width_door=config.block.size*width;""!=$(this).attr("width")&&$(this).css("width",width_door+"px");var height_element=config.block.size*height;""!=$(this).attr("height")&&$(this).css("height",height_element+"px"),$(this).hasClass("out")&&$(this).click(function(e){e.preventDefault(),confirm("Ir para outra tela?\nVocê irá para outro lugar")&&(config.map=$(this).attr("id"),socket.emit("map change",config.map))})})}function Effect_Apparate(who){$(who).append('<div class="effect apparate inner"></div>'),$(who).addClass("position-2-2").css("opacity",.25),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-4-2").css("opacity",.5),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-3-2").css("opacity",.75),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-1-2").css("opacity",1).find(".apparate").remove()},config.timing)},config.timing)},config.timing),$(who).animate({top:"-=20"},0,function(){$(who).animate({top:"+=20"},3*config.timing,function(){})})}function Action_KeyPressed(e){39==e.keyCode?(Action_CharacterMovement(character[me].who,"right","+",3),Action_UpdateUser(character[me].name,"right movement")):40==e.keyCode?(Action_CharacterMovement(character[me].who,"down","+",1),Action_UpdateUser(character[me].name,"down movement")):37==e.keyCode?(Action_CharacterMovement(character[me].who,"left","-",2),Action_UpdateUser(character[me].name,"left movement")):38==e.keyCode?(Action_CharacterMovement(character[me].who,"up","-",4),Action_UpdateUser(character[me].name,"up movement")):83==e.keyCode?Action_UpdateUser(character[me].name,"sit"):32==e.keyCode&&Action_UpdateUser(character[me].name,"jump")}function Action_CharacterMovement(who,position,polarity){var column_next,row_next,column=$(who).attr("column"),row=$(who).attr("row");"right"==position?(column_next=Number(column)+1,row_next=row):"left"==position?(column_next=Number(column)-1,row_next=row):"up"==position?(column_next=column,row_next=Number(row)-1):"down"==position&&(column_next=column,row_next=Number(row)+1),Action_OccupiedCheck(column_next,row_next,"simple")&&Action_OccupiedCheck(column_next,row_next,"exists")&&Action_OccupiedCheck(column_next,row_next,"occupied")&&0==config.movement_lock&&("+"==polarity?polarity_grid="-":"-"==polarity&&(polarity_grid="+"),grid.structure[column][row].occupied=!1,grid.structure[column_next][row_next].occupied=!0,config.movement_lock=!0,character[$(who).attr("id")].column=column_next,character[$(who).attr("id")].row=row_next,"right"==position||"left"==position?($(who).animate({left:polarity+"="+config.block.size},3*config.timing,function(){config.movement_lock=!1}),who==character[me].who&&grid.element.animate({left:polarity_grid+"="+config.block.size},3*config.timing,function(){}),"right"==position?$(who).attr("column",Number(column)+1):"left"==position&&$(who).attr("column",Number(column)-1)):("up"==position||"down"==position)&&($(who).animate({top:polarity+"="+config.block.size},3*config.timing,function(){config.movement_lock=!1}),who==character[me].who&&grid.element.animate({top:polarity_grid+"="+config.block.size},3*config.timing,function(){}),"up"==position?($(who).attr("row",Number(row)-1),setTimeout(function(){$(who).css("z-index",10*(Number(row)-1)+2)},3*config.timing)):"down"==position&&($(who).attr("row",Number(row)+1),$(who).css("z-index",10*(Number(row)+1)+2))),who==character[me].who&&Action_UpdateUser($(who).attr("id"),position))}function Action_OccupiedCheck(column,row,type){var value;return value="simple"==type?0!=row&&0!=column&&row<=grid.row&&column<=grid.column:"exists"==type?null!=grid.structure[column]&&null!=grid.structure[column][row]:"occupied"==type?0==grid.structure[column][row].occupied:0==grid.structure[column][row].occupied&&0!=row&&0!=column&&row<=grid.row&&column<=grid.column}function Action_AnimateCharacterMovement(who,position,direction){0==config.animation_movement_lock&&(config.animation_movement_lock=!0,Action_ClearPosition(who),$(who).removeClass("sit").addClass("position-"+direction+"-1"),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-"+direction+"-2"),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-"+direction+"-3"),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-"+direction+"-2"),character[$(who).attr("id")].position="position-"+direction+"-2",Action_UpdateUser($(who).attr("id"),"position"),config.animation_movement_lock=!1},config.timing)},config.timing)},config.timing))}function Action_ClearPosition(who){var classList=$(who).attr("class").split(/\s+/);$.each(classList,function(index,classItem){classItem.includes("position")&&$(who).removeClass(classItem)})}function Action_Sit(who){0==config.animation_movement_lock&&0==config.movement_lock&&($(who).hasClass("sit")?($(who).removeClass("sit"),character[$(who).attr("id")].sit=!1,Action_UpdateUser($(who).attr("id"),"position")):($(who).addClass("sit"),character[$(who).attr("id")].sit=!0,Action_UpdateUser($(who).attr("id"),"position")))}function Action_Jump(who){0!=config.animation_movement_lock||0!=config.movement_lock||$(who).hasClass("sit")||$(who).animate({top:"-=20"},config.timing,function(){$(who).animate({top:"+=20"},config.timing,function(){})})}var socket=io(),config={};config.block={size:84},config.timing=100,config.app=$(".app"),config.movement_lock=!0,config.animation_movement_lock=!0,config.map="ilha",config.door="initial",config.loading=".loading",config.started=!1;var grid={},me,character={};$(document).ready(function(){setTimeout(function(){Action_FadeOut(config.loading),Setup_Room()},2e3)}),config.movement_lock=!1,config.animation_movement_lock=!1;