function Setup_Grid(map,door){var url="map/"+map+".html";config.app.load(url,function(){grid.who="#grid",grid.element=$(grid.who),grid.structure=new Array,grid.column=Number(grid.element.attr("column")),grid.row=Number(grid.element.attr("row")),grid.width=grid.column*config.block,grid.height=grid.row*config.block,grid.element.width(grid.column*config.block).height(grid.row*config.block);var i;for(i=1;i<=grid.column;i++){grid.structure[i]=new Array;var j;for(j=1;j<=grid.row;j++)grid.structure[i][j]={occupied:!1}}Setup_Elements(),Load_Character(character[me].name,"#"+door)})}function Action_ArrangeGrid(column,row){var left=(column-1)*config.block;grid.element.css({left:"-"+left+"px"});var top=(row-1)*config.block;grid.element.css({top:"-"+top+"px"})}function Setup_Elements(){$(".element").each(function(){var column=Number($(this).attr("column")),row=Number($(this).attr("row")),occupied=$(this).attr("occupied"),width=Number($(this).attr("width")),height=Number($(this).attr("height"));"false"!=occupied&&(grid.structure[column][row].occupied=!0),$(this).css({top:(row-1)*config.block+"px",left:(column-1)*config.block+"px"});var width_element=config.block*width;if(""!=$(this).attr("width")&&($(this).css("width",width_element+"px"),"false"!=occupied)){var i;for(i=1;width-1>=i;i++)grid.structure[column+i][row].occupied=!0}var height_element=config.block*height;if(""!=$(this).attr("height")&&($(this).css("height",height_element+"px"),"false"!=occupied)){var i;for(i=1;height-1>=i;i++)grid.structure[column][row+i].occupied=!0}if(""!=$(this).attr("height")&&""!=$(this).attr("width")){var i;for(i=1;i<=Number($(this).attr("height"))-1;i++){var j;for(j=1;j<=Number($(this).attr("width"))-1;j++)grid.structure[column+j][row+i].occupied=!0}}})}function Load_Character(who,element){config.placement=0;var door={};door.element=element,door.column=Number($(door.element).attr("column")),door.row=Number($(door.element).attr("row")),Action_ArrangeCharacter(who,door.column,door.row,1)}function Action_ArrangeCharacter(who,column,row,position){Action_OccupiedCheck(column,row,"simple")&&Action_OccupiedCheck(column,row,"exists")?Action_OccupiedCheck(column,row,"occupied")?Action_PlaceCharacter(who,column,row):Action_ArrangeCharacterChecking(who,column,row,position):Action_ArrangeCharacterChecking(who,column,row,position)}function Action_ArrangeCharacterChecking(who,column,row,position){var element={};element.column=column,element.row=row;var next,turn,polarity;1==position?(next=2,turn="row",polarity="+",config.placement++):2==position?(next=3,turn="column",polarity="-"):3==position?(next=4,turn="row",polarity="-",config.placement++):4==position&&(next=1,turn="column",polarity="+");for(var i=1;i<=config.placement;i++)if("+"==polarity?element[turn]++:"-"==polarity&&element[turn]--,Action_OccupiedCheck(element.column,element.row,"simple")&&Action_OccupiedCheck(element.column,element.row,"exists")){if(Action_OccupiedCheck(element.column,element.row,"occupied")){Action_PlaceCharacter(who,element.column,element.row);break}if(i==config.placement){Action_ArrangeCharacter(who,element.column,element.row,next);break}}else if(i==config.placement){Action_ArrangeCharacter(who,element.column,element.row,next);break}}function Action_PlaceCharacter(who,column,row){Action_ArrangeGrid(column,row),character[who].map=config.map,Action_PlaceAllCharacters(who,character[who].item,column,row)}function Action_PlaceAllCharacters(who,item,column,row){grid.structure[column][row].occupied=!0,grid.element.append('<div id="'+who+'" class="character position-1-2" column="'+column+'" row="'+row+'" style="left:'+(column-1)*config.block+"px;top:"+(row-1)*config.block+'px;"></div>'),character[who].column=column,character[who].row=row,Action_ClearPosition("#"+who),Action_GetItems("#"+who,item),Effect_Apparate("#"+who)}function Action_GetItems(who,item){$.each(item,function(index,value){$(who).append('<div class="inner item '+index+" "+value+'"></div>')})}function Effect_Apparate(who){$(who).append('<div class="effect apparate inner"></div>'),$(who).addClass("position-2-2").css("opacity",.25),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-4-2").css("opacity",.5),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-3-2").css("opacity",.75),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-1-2").css("opacity",1).find(".apparate").remove()},config.timing)},config.timing)},config.timing),$(who).animate({top:"-=20"},0,function(){$(who).animate({top:"+=20"},3*config.timing,function(){})})}function Action_KeyPressed(e){39==e.keyCode?Action_CharacterMovement(character[me].who,"right","+",3):40==e.keyCode?Action_CharacterMovement(character[me].who,"down","+",1):37==e.keyCode?Action_CharacterMovement(character[me].who,"left","-",2):38==e.keyCode?Action_CharacterMovement(character[me].who,"up","-",4):83==e.keyCode?Action_Sit(character[me].who):32==e.keyCode?Action_Jump(character[me].who):65==e.keyCode&&Effect_Apparate(character[me].who)}function Action_CharacterMovement(who,position,polarity,direction){Action_AnimateCharacterMovement(who,position,direction);var column_next,row_next,column=$(who).attr("column"),row=$(who).attr("row");"right"==position?(column_next=Number(column)+1,row_next=row):"left"==position?(column_next=Number(column)-1,row_next=row):"up"==position?(column_next=column,row_next=Number(row)-1):"down"==position&&(column_next=column,row_next=Number(row)+1),Action_OccupiedCheck(column_next,row_next,"simple")&&Action_OccupiedCheck(column_next,row_next,"exists")&&Action_OccupiedCheck(column_next,row_next,"occupied")&&0==config.movement_lock&&("+"==polarity?polarity_grid="-":"-"==polarity&&(polarity_grid="+"),grid.structure[column][row].occupied=!1,grid.structure[column_next][row_next].occupied=!0,config.movement_lock=!0,character[$(who).attr("id")].column=column_next,character[$(who).attr("id")].row=row_next,"right"==position||"left"==position?($(who).animate({left:polarity+"="+config.block},3*config.timing,function(){config.movement_lock=!1}),grid.element.animate({left:polarity_grid+"="+config.block},3*config.timing,function(){}),"right"==position?$(who).attr("column",Number(column)+1):"left"==position&&$(who).attr("column",Number(column)-1)):("up"==position||"down"==position)&&($(who).animate({top:polarity+"="+config.block},3*config.timing,function(){config.movement_lock=!1}),grid.element.animate({top:polarity_grid+"="+config.block},3*config.timing,function(){}),"up"==position?$(who).attr("row",Number(row)-1):"down"==position&&$(who).attr("row",Number(row)+1)))}function Action_OccupiedCheck(column,row,type){var value;return value="simple"==type?0!=row&&0!=column&&row<=grid.row&&column<=grid.column:"exists"==type?null!=grid.structure[column]&&null!=grid.structure[column][row]:"occupied"==type?0==grid.structure[column][row].occupied:0==grid.structure[column][row].occupied&&0!=row&&0!=column&&row<=grid.row&&column<=grid.column}function Action_AnimateCharacterMovement(who,position,direction){0==config.animation_movement_lock&&(config.animation_movement_lock=!0,Action_ClearPosition(who),$(who).removeClass("sit").addClass("position-"+direction+"-1"),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-"+direction+"-2"),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-"+direction+"-3"),setTimeout(function(){Action_ClearPosition(who),$(who).addClass("position-"+direction+"-2"),config.animation_movement_lock=!1},config.timing)},config.timing)},config.timing))}function Action_ClearPosition(who){var classList=$(who).attr("class").split(/\s+/);$.each(classList,function(index,classItem){classItem.includes("position")&&$(who).removeClass(classItem)})}function Action_Sit(who){0==config.animation_movement_lock&&0==config.movement_lock&&($(who).hasClass("sit")?$(who).removeClass("sit"):$(who).addClass("sit"))}function Action_Jump(who){0!=config.animation_movement_lock||0!=config.movement_lock||$(who).hasClass("sit")||$(who).animate({top:"-=20"},config.timing,function(){$(who).animate({top:"+=20"},config.timing,function(){})})}var config={};config.block=84,config.timing=100,config.app=$(".app"),config.movement_lock=!0,config.animation_movement_lock=!0,config.map="ilha",config.door="initial";var grid={},me="odd_gus",character={};character[me]={},character[me].name="odd_gus",character[me].who="#"+character[me].name,character[me].item={},character[me].item["upper-body"]="cloak",character[me].item.hair="chanel",Setup_Grid("ilha","initial"),window.onkeydown=Action_KeyPressed,config.movement_lock=!1,config.animation_movement_lock=!1;